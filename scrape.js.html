<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scrape.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scrape.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const puppeteer = require('puppeteer')
const log = logger.child({module: 'scraper'})
/**
 * Scrapes the given URL on SRI relevant tags
 *
 * @param       {String}    URL         The URL that will be scraped
 * @returns     {Array.&lt;{
 *      'element': String,
 *      'type': String,
 *      'integrity': String,
 *      'cross_origin': String,
 *      'referrerpolicy': String,
 *      'defer': String,
 *      'src': (String|undefined),
 *      'href': (String|undefined),
 *      'async': (String|undefined),
 *      'nomodule': (String|undefined),
 *      'title': (String|undefined),
 *      'media': (String|undefined),
 *      'sizes': (String|undefined),
 *      'rel': (String|undefined),
 *      'hreflang': (String|undefined)
 * }>}                                  The scraped elements in JSON format
 *
 * @TODO        Do not include tags with no url
 * @TODO        Do not include tags with URL on same server
 * @TODO        Also scrape other subresouces (a, img, iframe, ...)
 */
async function scrape(URL) {
    log.verbose('Starting scraping ' + URL)

    const browser = await puppeteer.launch({
        headless: true
    });
    const page = await browser.newPage();

    await page.goto(URL);

    var tags = await page.evaluate(()=>{
        var out = []
        var scripts = document.querySelectorAll('script')
        for (const script of scripts) {
            out.push({
                'element': 'script',
                'type': script.getAttribute('type'),
                'src': script.getAttribute('src'),
                'integrity': script.getAttribute('integrity'),
                'cross_origin': script.getAttribute('cross-origin'),
                'referrerpolicy': script.getAttribute('referrerpolicy'),
                'async': script.getAttribute('async'),
                'defer': script.getAttribute('defer'),
                'nomodule': script.getAttribute('nomodule')
            })
        }

        var links = document.querySelectorAll('link')
        for (const link of links) {
            out.push({
                'element': 'link',
                'title': link.getAttribute('title'),
                'type': link.getAttribute('type'),
                'media': link.getAttribute('media'),
                'sizes': link.getAttribute('sizes'),
                'rel': link.getAttribute('rel'),
                'href': link.getAttribute('href'),
                'hreflang': link.getAttribute('hreflang'),
                'integrity': link.getAttribute('integrity'),
                'cross_origin': link.getAttribute('cross-origin'),
                'referrerpolicy': link.getAttribute('referrerpolicy')
            })
        }

        return out
    })

    browser.close()
    log.verbose('Done scraping ' + URL)
    return tags
}

module.exports = scrape
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#checkHashes">checkHashes</a></li><li><a href="global.html#checkResponseEligibility">checkResponseEligibility</a></li><li><a href="global.html#checkURL">checkURL</a></li><li><a href="global.html#scrape">scrape</a></li><li><a href="global.html#tagUsage">tagUsage</a></li><li><a href="global.html#tagValidity">tagValidity</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun Nov 28 2021 08:35:04 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
